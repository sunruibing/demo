/*!
 * jmessage-sdk-web.js
 * http://docs.jiguang.cn/client/im_sdk_js/
 * Version: 1.1.0
 *
 * Copyright 2016 jiguang
 */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.JIM=e()}}(function(){return function e(t,n,i){function o(s,_){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!_&&u)return u(s,!0);if(r)return r(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var a=n[s]={exports:{}};t[s][0].call(a.exports,function(e){var n=t[s][1][e];return o(n?n:e)},a,a.exports,e,t,n,i)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(e,t,n){"use strict";var i=e(3)();t.exports=function(){function e(e,n){n.on(e.events.ACK,function(e){r&&console.log("ack:"+JSON.stringify(e));var t,n;m[e.rid]&&(clearTimeout(m[e.rid].time_out_task),t=m[e.rid].ack_callback,n=m[e.rid].resp_callback),t&&t(e),!n&&delete m[e.rid]}),n.on(e.events.INIT,function(n){t(e.events.INIT,n)}),n.on(e.events.LOGIN,function(n){t(e.events.LOGIN,n)}),n.on(e.events.GET_USER_INFO,function(n){t(e.events.GET_USER_INFO,n)}),n.on(e.events.GET_ACROSS_USER_INFO,function(n){t(e.events.GET_ACROSS_USER_INFO,n)}),n.on(e.events.S_SINGLE_TEXT,function(n){t(e.events.S_SINGLE_TEXT,n)}),n.on(e.events.S_ACROSS_SINGLE_TEXT,function(n){t(e.events.S_ACROSS_SINGLE_TEXT,n)}),n.on(e.events.SEND_GROUP_MSG,function(n){t(e.events.SEND_GROUP_MSG,n)}),n.on(e.events.CREATE_GROUP,function(n){t(e.events.CREATE_GROUP,n)}),n.on(e.events.GET_GROUPS_LIST,function(n){t(e.events.GET_GROUPS_LIST,n)}),n.on(e.events.GET_GROUP_INFO,function(n){t(e.events.GET_GROUP_INFO,n)}),n.on(e.events.ADD_GROUP_MEMBER,function(n){t(e.events.ADD_GROUP_MEMBER,n)}),n.on(e.events.DEL_GROUP_MEMBER,function(n){t(e.events.DEL_GROUP_MEMBER,n)}),n.on(e.events.GET_GROUP_MEMBERS,function(n){t(e.events.GET_GROUP_MEMBERS,n)}),n.on(e.events.UPDATE_GROUP_INFO,function(n){t(e.events.UPDATE_GROUP_INFO,n)}),n.on(e.events.EXIT_GROUP,function(n){t(e.events.EXIT_GROUP,n)}),n.on(e.events.GET_CONVERSATIONS,function(n){t(e.events.GET_CONVERSATIONS,n)}),n.on(e.events.NO_DISTURB,function(n){t(e.events.NO_DISTURB,n)}),n.on(e.events.ADD_MSG_NO_DISTURB_SINGLE,function(n){t(e.events.ADD_MSG_NO_DISTURB_SINGLE,n)}),n.on(e.events.DELETE_MSG_NO_DISTURB_SINGLE,function(n){t(e.events.DELETE_MSG_NO_DISTURB_SINGLE,n)}),n.on(e.events.ADD_MSG_NO_DISTURB_GROUP,function(n){t(e.events.ADD_MSG_NO_DISTURB_GROUP,n)}),n.on(e.events.DELETE_MSG_NO_DISTURB_GROUP,function(n){t(e.events.DELETE_MSG_NO_DISTURB_GROUP,n)}),n.on(e.events.ADD_MSG_NO_DISTURB_GLOBAL,function(n){t(e.events.ADD_MSG_NO_DISTURB_GLOBAL,n)}),n.on(e.events.DELETE_MSG_NO_DISTURB_GLOBAL,function(n){t(e.events.DELETE_MSG_NO_DISTURB_GLOBAL,n)}),n.on(e.events.GET_UPLOAD_TOKEN,function(n){t(e.events.GET_UPLOAD_TOKEN,n)})}function t(e,t){r&&console.log(e+":"+JSON.stringify(t));var n;t.rid&&m[t.rid]&&(n=m[t.rid].resp_callback,n&&n(t),delete m[t.rid])}function n(e){this.client=e,this.version=1,this.from_platform="web"}var o,r,s,_,u,c,a=function(){this.version="1.0.0"},g="http://media.file.jpush.cn/",f=1,m={},d={},p=a.prototype;return p.events={ACK:"ack",INIT:"c_init",LOGIN:"login",LOGOUT:"logout",GET_USER_INFO:"get_user_info",GET_ACROSS_USER_INFO:"get_across_user_info",S_SINGLE_TEXT:"s_single_text",S_ACROSS_SINGLE_TEXT:"s_across_single_text",MSG_SYNC:"msg_sync",MSG_RECV:"msg_recv",SEND_GROUP_MSG:"send_group_msg",CREATE_GROUP:"create_group",GET_GROUPS_LIST:"get_groups_list",GET_GROUP_INFO:"get_group_info",ADD_GROUP_MEMBER:"add_group_member",DEL_GROUP_MEMBER:"del_group_member",GET_GROUP_MEMBERS:"get_group_members",UPDATE_GROUP_INFO:"update_group_info",EXIT_GROUP:"exit_group",EVENT_NOTIFICATION:"event_notification",GET_CONVERSATIONS:"get_conversations",GET_UPLOAD_TOKEN:"get_upload_token",NO_DISTURB:"no_disturb",ADD_MSG_NO_DISTURB_SINGLE:"add_msg_no_disturb_single",DELETE_MSG_NO_DISTURB_SINGLE:"delete_msg_no_disturb_single",ADD_MSG_NO_DISTURB_GROUP:"add_msg_no_disturb_group",DELETE_MSG_NO_DISTURB_GROUP:"delete_msg_no_disturb_group",ADD_MSG_NO_DISTURB_GLOBAL:"add_msg_no_disturb_global",DELETE_MSG_NO_DISTURB_GLOBAL:"delete_msg_no_disturb_global",DISCONNECT:"disconnect"},p.init=function(e){var t=e?e:{};_=window.WebSocket?["websocket"]:["polling"],r=t.debug?t.debug:!1,o=t.address?t.address:"wss://ws.im.jpush.cn",u=t.debug?3:0,s=t.timeout?t.timeout:3e4,r&&console.log("transport with:"+_)},p.login=function(t,n,a,g,f,m,p){if(!_||!o||!s)return console.error("必须先执行JIM.init()才可以进行JIM.login()操作");var l=this;r&&console.log("connect to "+o),c=io(o,{transports:_,reconnection:!0,autoConnect:!0,"force new connection":!0,reconnectionDelay:500,reconnectionDelayMax:1e3,timeout:s,"max reconnection attempts":1,"log level":u}),e(this,c),l.emitWithResp(l.events.INIT,a,function(e){e&&0==e.code?l.emitWithResp(l.events.LOGIN,{username:t,password:p?n:i(n)},function(e){e&&e.username&&(d.state="online",d.username=e.username,g&&g(e))},f,m):(r&&console.log("init fail : "+JSON.stringify(e)),g&&g(e))},null,m)},p.getUserInfo=function(e,t,n,i){var o=this;o.emitWithResp(o.events.GET_USER_INFO,{key:e},t,n,i)},p.getAcrossUserInfo=function(e,t,n,i,o){var r=this;r.emitWithResp(r.events.GET_ACROSS_USER_INFO,{key:e,appkey:t},n,i,o)},p.sendSingleMsg=function(e,t,i,o,r){new n(this).setType("single").setTarget(e).setText(t).send(i,o,r)},p.sendAcrossSingleMsg=function(e,t,i,o,r,s){new n(this).setType("across_single").setTarget(e).setAppkey(t).setText(i).send(o,r,s)},p.getUploadToken=function(e,t,n){var i=this;i.emitWithResp(i.events.GET_UPLOAD_TOKEN,{},e,t,n)},p.sendSinglePic=function(e,t,i,o,r){new n(this).setType("single").setTarget(e).setImage(t).send(i,o,r)},p.sendGroupMsg=function(e,t,i,o,r){new n(this).setType("group").setTarget(e).setText(t).send(i,o,r)},p.createMsgBuilder=function(){return new n(this)},p.createGroup=function(e,t,n,i,o){var r=this;r.emitWithResp(r.events.CREATE_GROUP,{group_name:e,group_description:t},n,i,o)},p.getGroupList=function(e,t,n){var i=this;i.emitWithResp(i.events.GET_GROUPS_LIST,{},e,t,n)},p.getGroupInfo=function(e,t,n,i){var o=this;o.emitWithResp(o.events.GET_GROUP_INFO,{gid:e.toString()},t,n,i)},p.addGroupMember=function(e,t,n,i,o){var r=this;r.emitWithResp(r.events.ADD_GROUP_MEMBER,{gid:e.toString(),member_usernames:t},n,i,o)},p.delGroupMember=function(e,t,n,i,o){var r=this;r.emitWithResp(r.events.DEL_GROUP_MEMBER,{gid:e.toString(),member_usernames:t},n,i,o)},p.getGroupMembers=function(e,t,n,i){var o=this;o.emitWithResp(o.events.GET_GROUP_MEMBERS,{gid:e.toString()},t,n,i)},p.updateGroupInfo=function(e,t,n,i,o,r){var s=this;s.emitWithResp(s.events.UPDATE_GROUP_INFO,{gid:e.toString(),group_name:t,group_description:n},i,o,r)},p.exitGroup=function(e,t,n,i){var o=this;o.emitWithResp(o.events.EXIT_GROUP,{gid:e.toString()},t,n,i)},p.getConversations=function(e,t,n){var i=this;i.emitWithResp(i.events.GET_CONVERSATIONS,{},e,t,n)},p.getNoDisturb=function(e,t,n){var i=this;i.emitWithResp(i.events.NO_DISTURB,{version:0},e,t,n)},p.addSingleNoDisturb=function(e,t,n,i){var o=this;o.emitWithResp(o.events.ADD_MSG_NO_DISTURB_SINGLE,{version:0,target_name:e},t,n,i)},p.deleteSingleNoDisturb=function(e,t,n,i){var o=this;o.emitWithResp(o.events.DELETE_MSG_NO_DISTURB_SINGLE,{version:0,target_name:e},t,n,i)},p.addGroupNoDisturb=function(e,t,n,i){var o=this;o.emitWithResp(o.events.ADD_MSG_NO_DISTURB_GROUP,{version:0,gid:e.toString()},t,n,i)},p.deleteGroupNoDisturb=function(e,t,n,i){var o=this;o.emitWithResp(o.events.DELETE_MSG_NO_DISTURB_GROUP,{version:0,gid:e.toString()},t,n,i)},p.addGlobalNoDisturb=function(e,t,n){var i=this;i.emitWithResp(i.events.ADD_MSG_NO_DISTURB_GLOBAL,{version:0,none:""},e,t,n)},p.deleteGlobalNoDisturb=function(e,t,n){var i=this;i.emitWithResp(i.events.DELETE_MSG_NO_DISTURB_GLOBAL,{version:0,none:""},e,t,n)},p.loginOut=function(){if(!c)return console.error("必须执行login操作成功后才能执行此动作");var e=this;e.disconnect()},p.onMsgReceive=function(e){var t=this;t.on(t.events.MSG_SYNC,function(n){r&&console.log("消息同步:"+JSON.stringify(n)),n.messages.forEach(function(t){var n={};n.target_type=t.content.target_type,n.target_name=t.content.target_name,n.target_id=t.content.target_id,n.from_name=t.content.from_name,n.from_id=t.content.from_id,n.from_platform=t.content.from_platform,n.create_time=t.ctime_ms,n.msg_type=t.content.msg_type,n.msg_body=t.content.msg_body,n.msg_body.isFileUploaded&&delete n.msg_body.isFileUploaded,"image"==t.content.msg_type?n.msg_body.media_url=g+t.content.msg_body.media_id:"voice"==t.content.msg_type&&(n.msg_body.media_url=g+t.content.msg_body.media_id+".mp3"),0===t.msg_level?n.msg_level="normal":1===t.msg_level&&(n.msg_level="across",n.target_appkey=t.content.target_appkey,n.from_appkey=t.content.from_appkey),e&&e(n)});var i=[];Array.prototype.push.apply(i,n.messages.map(function(e){return{msg_id:e.msg_id,msg_type:e.msg_type,from_uid:e.from_uid,from_gid:e.from_gid}})),t.emitWithCallback(t.events.MSG_RECV,{messages:i})})},p.onDisconnect=function(e){},p.onEvent=function(e){var t=this;t.on(t.events.EVENT_NOTIFICATION,function(n){r&&console.log("事件同步 : "+JSON.stringify(n)),e&&e(n),t.emitWithCallback(t.events.EVENT_NOTIFICATION,{event_id:n.event_id,event_type:n.event_type,from_uid:n.from_uid,gid:n.gid})})},p.emitWithResp=function(e,t,n,i,o){if(!c)return console.error("必须执行login操作后能执行此动作");t.rid=f++,c.emit(e,t);var r=setTimeout(function(){o&&o(t),delete m[t.rid]},s);return m[t.rid]={data:t,time_out_task:r,ack_callback:i,resp_callback:n},t},p.emitWithCallback=function(e,t){return c?(t.rid=f++,void c.emit(e,t)):console.error("必须执行login操作成功后才能执行此动作")},p.on=function(){return c?void c.on.apply(c,arguments):console.error("必须执行login操作成功后才能进行此事件监听")},n.prototype.setType=function(e){return this.type=e,this},n.prototype.setAppkey=function(e){return this.appkey=e,this},n.prototype.setTarget=function(e,t){return this.target_id=e.toString(),this.target_name=t,this},n.prototype.setFromName=function(e){return this.from_name=e,this},n.prototype.setText=function(e,t){return this.msg_type="text",this.msg_body={text:e,extras:t},this},n.prototype.setImage=function(e){return this.msg_type="image",this.msg_body={media_id:e.media_id,width:e.width,height:e.height,format:e.format,fsize:e.fsize},this},n.prototype.setCustom=function(e){return this.msg_type="custom",this.msg_body=e,this},n.prototype.build=function(){var e=d.username;if(!e)return console.error("必须执行login操作后能执行此动作");if("single"!=this.type&&"group"!=this.type&&"across_single"!=this.type)return console.log("消息类型必须是single或group");if(!this.target_id)return console.error("target_id不能为空");if("text"==this.msg_type){if(!this.msg_body.text)return console.error("未设置文本消息内容")}else if("custom"==this.msg_type){if(!this.msg_body)return console.error("custom对象不能为空")}else if("voice"==this.msg_type){if(!this.msg_body.media_id)return console.error("未设置voice消息media_id字段");if(!this.msg_body.duration)return console.error("未设置voice消息duration字段");if(!this.msg_body.format)return console.error("未设置voice消息format字段");if(!this.msg_body.fsize)return console.error("未设置voice消息fsize字段")}else{if("image"!=this.msg_type)return console.error("请指定消息类型");if(!this.msg_body.media_id)return console.error("未设置image消息media_id字段");if(!this.msg_body.width)return console.error("未设置image消息width字段");if(!this.msg_body.height)return console.error("未设置image消息height字段")}var t={version:this.version,target_type:this.type,from_platform:this.from_platform,target_id:this.target_id,target_name:this.target_name,from_id:e,from_name:this.from_name,create_time:(new Date).getTime(),msg_type:this.msg_type,msg_body:this.msg_body};return this.appkey?t.appkey=this.appkey:null,t},n.prototype.send=function(e,t,n){var i=this.build();if(i){var o,s;"single"==i.target_type?(o=this.client.events.S_SINGLE_TEXT,s={target_name:i.target_id}):"across_single"==i.target_type?(o=this.client.events.S_ACROSS_SINGLE_TEXT,i.target_type="sigle",s={target_name:i.target_id,appkey:i.appkey}):(o=this.client.events.SEND_GROUP_MSG,s={target_gid:i.target_id}),r&&console.log(JSON.stringify(i)),s.content=i,this.client.emitWithResp(o,s,e,t,n)}},a}},{3:3}],2:[function(e,t,n){var i=e(1)();window.JIM=t.exports=new i},{1:1}],3:[function(e,t,n){"use strict";t.exports=function(){function e(e,t){var n=(65535&e)+(65535&t),i=(e>>16)+(t>>16)+(n>>16);return i<<16|65535&n}function t(e,t){return e<<t|e>>>32-t}function n(n,i,o,r,s,_){return e(t(e(e(i,n),e(r,_)),s),o)}function i(e,t,i,o,r,s,_){return n(t&i|~t&o,e,t,r,s,_)}function o(e,t,i,o,r,s,_){return n(t&o|i&~o,e,t,r,s,_)}function r(e,t,i,o,r,s,_){return n(t^i^o,e,t,r,s,_)}function s(e,t,i,o,r,s,_){return n(i^(t|~o),e,t,r,s,_)}function _(t,n){t[n>>5]|=128<<n%32,t[(n+64>>>9<<4)+14]=n;var _,u,c,a,g,f=1732584193,m=-271733879,d=-1732584194,p=271733878;for(_=0;_<t.length;_+=16)u=f,c=m,a=d,g=p,f=i(f,m,d,p,t[_],7,-680876936),p=i(p,f,m,d,t[_+1],12,-389564586),d=i(d,p,f,m,t[_+2],17,606105819),m=i(m,d,p,f,t[_+3],22,-1044525330),f=i(f,m,d,p,t[_+4],7,-176418897),p=i(p,f,m,d,t[_+5],12,1200080426),d=i(d,p,f,m,t[_+6],17,-1473231341),m=i(m,d,p,f,t[_+7],22,-45705983),f=i(f,m,d,p,t[_+8],7,1770035416),p=i(p,f,m,d,t[_+9],12,-1958414417),d=i(d,p,f,m,t[_+10],17,-42063),m=i(m,d,p,f,t[_+11],22,-1990404162),f=i(f,m,d,p,t[_+12],7,1804603682),p=i(p,f,m,d,t[_+13],12,-40341101),d=i(d,p,f,m,t[_+14],17,-1502002290),m=i(m,d,p,f,t[_+15],22,1236535329),f=o(f,m,d,p,t[_+1],5,-165796510),p=o(p,f,m,d,t[_+6],9,-1069501632),d=o(d,p,f,m,t[_+11],14,643717713),m=o(m,d,p,f,t[_],20,-373897302),f=o(f,m,d,p,t[_+5],5,-701558691),p=o(p,f,m,d,t[_+10],9,38016083),d=o(d,p,f,m,t[_+15],14,-660478335),m=o(m,d,p,f,t[_+4],20,-405537848),f=o(f,m,d,p,t[_+9],5,568446438),p=o(p,f,m,d,t[_+14],9,-1019803690),d=o(d,p,f,m,t[_+3],14,-187363961),m=o(m,d,p,f,t[_+8],20,1163531501),f=o(f,m,d,p,t[_+13],5,-1444681467),p=o(p,f,m,d,t[_+2],9,-51403784),d=o(d,p,f,m,t[_+7],14,1735328473),m=o(m,d,p,f,t[_+12],20,-1926607734),f=r(f,m,d,p,t[_+5],4,-378558),p=r(p,f,m,d,t[_+8],11,-2022574463),d=r(d,p,f,m,t[_+11],16,1839030562),m=r(m,d,p,f,t[_+14],23,-35309556),f=r(f,m,d,p,t[_+1],4,-1530992060),p=r(p,f,m,d,t[_+4],11,1272893353),d=r(d,p,f,m,t[_+7],16,-155497632),m=r(m,d,p,f,t[_+10],23,-1094730640),f=r(f,m,d,p,t[_+13],4,681279174),p=r(p,f,m,d,t[_],11,-358537222),d=r(d,p,f,m,t[_+3],16,-722521979),m=r(m,d,p,f,t[_+6],23,76029189),f=r(f,m,d,p,t[_+9],4,-640364487),p=r(p,f,m,d,t[_+12],11,-421815835),d=r(d,p,f,m,t[_+15],16,530742520),m=r(m,d,p,f,t[_+2],23,-995338651),f=s(f,m,d,p,t[_],6,-198630844),p=s(p,f,m,d,t[_+7],10,1126891415),d=s(d,p,f,m,t[_+14],15,-1416354905),m=s(m,d,p,f,t[_+5],21,-57434055),f=s(f,m,d,p,t[_+12],6,1700485571),p=s(p,f,m,d,t[_+3],10,-1894986606),d=s(d,p,f,m,t[_+10],15,-1051523),m=s(m,d,p,f,t[_+1],21,-2054922799),f=s(f,m,d,p,t[_+8],6,1873313359),p=s(p,f,m,d,t[_+15],10,-30611744),d=s(d,p,f,m,t[_+6],15,-1560198380),m=s(m,d,p,f,t[_+13],21,1309151649),f=s(f,m,d,p,t[_+4],6,-145523070),p=s(p,f,m,d,t[_+11],10,-1120210379),d=s(d,p,f,m,t[_+2],15,718787259),m=s(m,d,p,f,t[_+9],21,-343485551),f=e(f,u),m=e(m,c),d=e(d,a),p=e(p,g);return[f,m,d,p]}function u(e){var t,n="";for(t=0;t<32*e.length;t+=8)n+=String.fromCharCode(e[t>>5]>>>t%32&255);return n}function c(e){var t,n=[];for(n[(e.length>>2)-1]=void 0,t=0;t<n.length;t+=1)n[t]=0;for(t=0;t<8*e.length;t+=8)n[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return n}function a(e){return u(_(c(e),8*e.length))}function g(e,t){var n,i,o=c(e),r=[],s=[];for(r[15]=s[15]=void 0,o.length>16&&(o=_(o,8*e.length)),n=0;16>n;n+=1)r[n]=909522486^o[n],s[n]=1549556828^o[n];return i=_(r.concat(c(t)),512+8*t.length),u(_(s.concat(i),640))}function f(e){var t,n,i="0123456789abcdef",o="";for(n=0;n<e.length;n+=1)t=e.charCodeAt(n),o+=i.charAt(t>>>4&15)+i.charAt(15&t);return o}function m(e){return unescape(encodeURIComponent(e))}function d(e){return a(m(e))}function p(e){return f(d(e))}function l(e,t){return g(m(e),m(t))}function E(e,t){return f(l(e,t))}function v(e,t,n){return t?n?l(t,e):E(t,e):n?d(e):p(e)}return v}},{}]},{},[2])(2)});